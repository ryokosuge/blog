---
import { load } from "cheerio";
import hljs from "highlight.js";
import "highlight.js/styles/github-dark-dimmed.css";

import BlogLayout from "../../layouts/BlogLayout.astro";
import { getBlog, getBlogs } from "../../libs/microcms";

export const getStaticPaths = async () => {
  const blogs = await getBlogs();
  return blogs.contents.map((content) => ({
    params: {
      contentId: content.id,
    },
  }));
};

const { contentId } = Astro.params;
const blog = await getBlog({ contentId: contentId ?? "" });
const $ = load(blog.content);
$("pre code").each((_, element) => {
  const result = hljs.highlightAuto($(element).text());
  $(element).html(result.value);
  $(element).addClass("hljs");
});
---

<BlogLayout content={blog}>
  <div set:html={$.html()} />
</BlogLayout>
